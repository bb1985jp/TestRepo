<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="ja">

<head>

<meta http-equiv="Content-Style-Type" content="text/css; charset=Shift-JIS">
<link rel="stylesheet" href="java.css" type="text/css">
<meta http-equiv="Content-Script-Type" content="text/javascript">
<meta http-equiv="Content-Type" content="text/html; charset=shift_jis">
<meta content="Java,Swing,Tips,Drag and Drop" name="keywords">

<title>Java Swing サンプル集</title>
</head>

<body>
<table class="table_1" align="center" summary="Swing,Look and Feel">
<tbody>
<tr>
<td class="table_1">
<table summary="outline">
<tbody>
<tr>
<td class="title_site">
Java Swing サンプル集
</td>
</tr>
<tr>
<td valign="top" align="center">
<hr>
</td>
</tr>
<tr>
<td>
<a href="index.html">Top Page</a>                                      
<br>                                      
</td>                                      
</tr>                                      
<tr>                                      
<td class="title_page">                                      
<img src="images/glass_icon2.gif" width="16" height="16" alt="*">                                      
ドラッグ＆ドロップ<br>                                      
<img src="images/ber91.gif" class="title_page_line" alt="-" width="432" height="15">                                      
</td>                                      
</tr>                                      
<tr>                                      
<td class="title_section">                                      
<div class="space">                                      
<img src="images/threesquare_icon002.gif" width="12" height="10" alt="･">説明１<br>                                      
                                      
<img src="images/ber005.gif" class="section_line" alt="-" width="150" height="5"> 
</div>                                      
</td>                                      
</tr>                                      
<tr>                                      
<td>                                      
                                      
<table summary="description">                                      
<tbody>                                      
<tr>                                      
<td class="column_left">                                      
                                      
<p>                                   
ドラッグ＆ドロップには対象、ドラッグ先などにより方法が数パターン存在します。                                   
</p>                                   
<p>                                   
コード例１は、各コンポーネントに存在するメソッドsetDragEnabled()でtrueを指定する、という最も簡単な方法。                                   
</p>                                   
<p>                                   
ただしこの方法の場合、コンポーネントによりドラッグ可能な物が異なります。<br>                                   
JTextFieldやJTextAreaの場合はプレーンテキストのみ受け付けます。<br>                                   
エクスプローラ等からのファイルリストは受け付けません。<br>                                   
しかも、JLabelにはsetDragEnabled()メソッド自体存在しません。<br>                                      
</td>                                      
<td class="column_right">                                      
                                      
<!-- ///// Amazon ///// -->                                      
                                      
<iframe src="http://rcm-jp.amazon.co.jp/e/cm?t=bb1985-22&o=9&p=10&l=st1&mode=books-jp&search=Java%20Swing%20GUI&fc1=000000&lt1=&lc1=3366FF&bg1=FFFFFF&f=ifr" marginwidth="0" marginheight="0" width="120" height="450" border="0" frameborder="0" style="border:none;" scrolling="no"></iframe>                                      
                                      
<!-- ///// Amazon ///// -->                                      
                                      
</td>                                      
</tr>                                      
</tbody>                                      
</table>                                      
</td>                                      
</tr>                                      
<tr>                                      
<td class="title_section">                                      
<div class="space">                                      
<img border="0" src="images/threesquare_icon002.gif" width="12" height="10" alt="･">コード例１<br>                                      
                                      
<img src="images/ber005.gif" class="section_line" alt="-" width="150" height="5"> 
</div>                                      
</td>                                      
</tr>                                      
<tr>                                      
<td>                                      
<br>                                      
<table class="table_code" summary="code">                                      
  <tbody>                                      
  <tr>                                      
    <td>                                      
    <pre>jtextfield.setDragEnabled(true);</pre>                                      
    </td>                                      
  </tr>                                      
  </tbody>                                      
</table>                                      
</td>                                      
</tr>                                      
<tr>                                      
<td class="title_section">                                      
<div class="space">                                      
<img border="0" src="images/threesquare_icon002.gif" width="12" height="10" alt="･">説明２<br>                                      
                                      
<img src="images/ber005.gif" class="section_line" alt="-" width="150" height="5"> 
</div>                                      
</td>                                      
</tr>                                      
<tr>                                      
<td>                                      
<p>                              
JLabel、JTextField、JTextAreaで共通してエクスプローラ等からファイルリストのドラッグ＆ドロップを受け付けるためには、以下のように実装します。                              
</p>                              
<ol>                              
<li>DropTargetListenerを実装した（またはDropTargetAdapterを継承した）クラスを定義する。</li>                              
                              
<li>上記クラス内drop()メソッドをオーバーライドする。<br>                              
  （このメソッドは何かがドロップされた際に呼び出される。）</li>                              
                              
<li>drop()メソッド内でドロップされたものがファイルリストの場合のみ処理を行う、という判定分を入れる。                              
  具体例としては、                              
  <pre>
  if (transfer.isDataFlavorSupported(DataFlavor.javaFileListFlavor)) {
                                                これがファイルリストを示す
  
      ・・・
  }
</pre>                              
  ここでは DataFlavor.javaFileListFlavor がファイルリストを示しているが、同様にイメージファイル（*.gifなど）のみを受け付けるようにすることも出来る。</li>                              
                              
<li>上記<code>if</code>文内でドロップを受け付ける。                              
  <pre>
  e.acceptDrop(DnDConstants.ACTION_COPY_OR_MOVE);
  </pre>                              
  このあとに行いたい処理を実装する。</li>                              
                              
<li>アプリの初期化処理内等で上記で定義したドロップターゲットを設定する。                              
<pre>
  DropTarget target = new DropTarget(component, new SampleDropTargetAdapter());

  ※上記１行は以下と同等
  
  try {
      DropTarget target = new DropTarget();
      target.addDropTargetListener(new SampleDropTargetAdapter());
      component.setDropTarget(target);
  }
  catch(TooManyListenersException tmle) {
      tmle.printStackTrace();
  }</pre></li>                              
</ol>                              
</td>                                      
</tr>                                      
<tr>                                      
<td class="title_section">                                      
<div class="space">                                      
<img border="0" src="images/threesquare_icon002.gif" width="12" height="10" alt="･">コード例２<br>                                      
                                      
<img src="images/ber005.gif" class="section_line" alt="-" width="150" height="5"> 
</div>                                      
</td>                                      
</tr>                                      
<tr>                                      
<td>                                      
<br>                                      
<table class="table_code" summary="code">                                      
  <tbody>                                      
  <tr>                                      
    <td>                                      
    <pre>    private void initialize() {
        ・・・・
        DropTarget target = new DropTarget(jTextArea, new SampleDropTargetAdapter());
    }

    private class SampleDropTargetAdapter extends DropTargetAdapter {
        
        public void drop(DropTargetDropEvent e) {
            try {
                Transferable transfer = e.getTransferable();
                // ファイルリストの転送を受け付ける
                if (transfer.isDataFlavorSupported(DataFlavor.javaFileListFlavor)) {
                    // copyとmoveを受け付ける
                    e.acceptDrop(DnDConstants.ACTION_COPY_OR_MOVE);
                    // ドラッグ＆ドロップされたファイルのリストを取得
                    java.util.List fileList =
                        (List) transfer.getTransferData(DataFlavor.javaFileListFlavor);
                    // 取得したファイルの名称を表示
                    Iterator iterator = fileList.iterator();
                    while(iterator.hasNext()) {
                        getJTextArea().append(((File)iterator.next()).getName() + &quot;\n&quot;);
                    }
                }
            } catch (UnsupportedFlavorException e1) {
                e1.printStackTrace();
            } catch (IOException e2) {
                e2.printStackTrace();
            }
        }
    }
</pre>                                      
    </td>                                      
  </tr>                                      
  </tbody>                                      
</table>                                      
</td>                                      
</tr>                                      
<tr>                                      
<td>                                      
<div class="space_both">                                      
<img border="0" src="app/images/drag_and_drop.jpg" width="300" height="239">                                     
</div>                                     
<div class="space">                                     
サンプルソース : <a href="src/src_drag_and_drop.zip">src_drag_and_drop.zip</a>                                     
</div>                                     
<div class="space_both">                                     
サンプルアプリ : <a href="app/sample_drag_and_drop.jar">sample_drag_and_drop.jar</a>                                     
</div>                                     
<br>                                     
             
<!-- ///// Google ///// -->                                    
<script type="text/javascript"><!--             
google_ad_client = "pub-4667966388895726";             
/* 728x90, 作成済み 09/01/26 */             
google_ad_slot = "1570626113";             
google_ad_width = 728;             
google_ad_height = 90;             
google_language = 'ja';             
//-->             
</script>             
<script type="text/javascript"             
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">             
</script>             
<!-- ///// Google ///// -->          
</td>                
</tr>                        
</tbody>                                     
</table>                                     
</td>                   
</tr>                        
</tbody>                                     
</table>                                
</body>                                     
                                     
</html>                                     
